{% extends "layout.html" %} {% block title %} Coalitions {% endblock %} {% block body %}

<div class="templatediv">

    <div class="templatedivtopper coalitionstopper">
        <h1 class="templatedivtitle"><span class="material-icons-outlined iconlarge">
            public
            </span>Coalitions</h1>
    </div>

    <div class="templatedivcontent">
        <form action="/coalitions" method="GET">
            <div class="templatedivflex2 divflex2full">

                <div class="templatedivflex2left">

                    <select name="sort" class="templateselect">
                        <option value="influence" class="templateoption" {% if selected_sort == 'influence' %}selected{% endif %}>Influence</option>
                        <option value="age" class="templateoption" {% if selected_sort == 'age' %}selected{% endif %}>Age</option>
                        <option value="invite_only" class="templateoption" {% if selected_sort == 'invite_only' %}selected{% endif %}>Invite Only</option>
                        <option value="open" class="templateoption" {% if selected_sort == 'open' %}selected{% endif %}>Open</option>
                        <option value="members" class="templateoption" {% if selected_sort == 'members' %}selected{% endif %}>Members</option>
                    </select>

                </div>
                <div class="templatedivflex2right">

                    <select name="sortway" class="templateselect">
                        <option value="desc" class="templateoption" {% if sortway == 'desc' %}selected{% endif %}>Descending</option>
                        <option value="asc" class="templateoption" {% if sortway == 'asc' %}selected{% endif %}>Ascending</option>
                    </select>

                </div>

                <div class="templatedivflex2left">
                    <input class="loginsignupinput templateflexfullinput" autocomplete="off" name="search" placeholder="Search by name or ID" value="{{ search or '' }}" />
                </div>
                <div class="templatedivflex2right">
                    <select name="per_page" class="templateselect">
                        <option value="50" class="templateoption" {% if per_page == 50 %}selected{% endif %}>50 per page</option>
                        <option value="100" class="templateoption" {% if per_page == 100 %}selected{% endif %}>100 per page</option>
                        <option value="150" class="templateoption" {% if per_page == 150 %}selected{% endif %}>150 per page</option>
                    </select>
                </div>

                <div class="templatedivflex2left">
                    <button class="center templatedivbutton smallactionbutton" type="submit"><span class="material-icons-outlined">
                        arrow_forward
                        </span>Submit</button>
                </div>

            </div>
            <div class="templatedivflex2 menuflex divflex2center">
                <div class="templatedivflex2left">

                    <ul class="recruitmentlabel">Looking for a coalition?</ul>

                </div>
                <div class="templatedivflex2right">

                    <a href="/recruitments" class="templatedivbutton templatecenteredbutton"><span class="material-icons-outlined">
                    group_add
                    </span>Recruitment list</a>

                </div>
            </div>

            <div class="templateoutertablediv">
                <table class="templatetable templatetable2">
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Influence</th>
                        <th>Members</th>
                        <th>Date Created</th>
                        <th>Type</th>
                    </tr>
                    {% for col in coalitions %}
                    <tr>
                        <td>{{ loop.index }})</td>
                        <td>
                            <img src="/flag/coalition/{{ col.id }}" alt="" style="width: 24px; height: 16px; vertical-align: middle; margin-right: 6px; border-radius: 2px; object-fit: cover;">
                            <a href="/coalition/{{ col.id }}">{{ col.name }}</a>
                        </td>
                        <td>{{ col.influence }}</td>
                        <td>{{ col.members }}</td>
                        <td>{{ col.date }}</td>
                        <td>{{ col.type }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>

            <!-- Result count info -->
            {% if total_count is defined %}
            <p style="text-align: center; margin: 10px 0; color: #888;">
                Showing {{ coalitions|length }} of {{ total_count }} coalitions
                {% if search %} matching "{{ search }}"{% endif %}
            </p>
            {% endif %}

            <!-- Pagination controls -->
            {% if total_pages and total_pages > 1 %}
            <div class="pagination" style="text-align: center; margin-top: 20px; padding: 10px;">
                {% if current_page > 1 %}
                    <a href="{{ url_for('coalitions', page=1, sort=selected_sort, sortway=sortway, search=search, per_page=per_page) }}" class="templatedivbutton smallactionbutton">First</a>
                    <a href="{{ url_for('coalitions', page=current_page - 1, sort=selected_sort, sortway=sortway, search=search, per_page=per_page) }}" class="templatedivbutton smallactionbutton">← Prev</a>
                {% endif %}

                <!-- Page number links -->
                {% set start_page = [current_page - 2, 1] | max %}
                {% set end_page = [current_page + 2, total_pages] | min %}

                {% for p in range(start_page, end_page + 1) %}
                    {% if p == current_page %}
                        <span class="templatedivbutton smallactionbutton" style="background: #444;">{{ p }}</span>
                    {% else %}
                        <a href="{{ url_for('coalitions', page=p, sort=selected_sort, sortway=sortway, search=search, per_page=per_page) }}" class="templatedivbutton smallactionbutton">{{ p }}</a>
                    {% endif %}
                {% endfor %}

                {% if current_page < total_pages %}
                    <a href="{{ url_for('coalitions', page=current_page + 1, sort=selected_sort, sortway=sortway, search=search, per_page=per_page) }}" class="templatedivbutton smallactionbutton">Next →</a>
                    <a href="{{ url_for('coalitions', page=total_pages, sort=selected_sort, sortway=sortway, search=search, per_page=per_page) }}" class="templatedivbutton smallactionbutton">Last</a>
                {% endif %}
            </div>
            {% endif %}
    </div>
</div>

{% endblock%}
