{% extends "layout.html" %} {% block title %} Account {% endblock %} {% block body %}
<div class="templatediv">

    <div class="templatedivtopper noboxshadowtopper">
        <h1 class="templatedivtitle"><span class="material-icons-outlined iconlarge">
            perm_identity
            </span>{{ name }}'s Account</h1>
    </div>

    <div class="templatedivcontent">

        <h2 class="templatecontentheaderleft">Account Information</h2>


        <form action="/change" method="POST">
            <div class="infodiv">
                <div class="templateoutertablediv">
                    <table class="templatetable templatetable2">
                        <tr>
                            <th>Category</th>
                            <th>Value</th>
                            <th>Change Info</th>
                        </tr>
                        <tr>
                            <td>Country:</td>
                            <td>{{ user["username"] }}</td>
                            <td><input class="loginsignupinput" name="name" placeholder="New name" /></td>
                        </tr>
                        <tr>
                            <td>Email:</td>
                            <td>{{ user["email"] }}</td>
                            <td><input class="loginsignupinput" name="email" placeholder="New email" /></td>
                        </tr>
                        <tr>
                            <td>Password:</td>
                            <td>************</td>
                            <td><button formaction="/request_password_reset" type="submit" class="templatedivbutton templatecenteredbutton"><span class="material-icons-outlined">
                                arrow_forward
                                </span>Send email</button></td>
                        </tr>
                        <tr>
                            <td>Date joined:</td>
                            <td>{{ user["date"] }}</td>
                            <td></td>
                        </tr>
                    </table>
                </div>

                <input class="loginsignupinput" name="current_password" placeholder="Enter current password" />

                <button class="templatedivbutton templatecenteredbutton" type="submit"><span class="material-icons-outlined">
                    check
                    </span>Update</button>
            </div>
        </form>

        <h2 class="templatecontentheaderleft">General</h2>

        <div class="infodiv">

            <!--
            <input class="loginsignupinput" name="" placeholder="Discord Username" />
            -->

            <label class="templatecheckmarklabel fit">Dark Mode
                <input type="checkbox" onchange="toggleTheme()" id="slider">
                <span class="templatecheckmark center"></span>
              </label>

            <!-- <button id="templatedivbutton" class="templatedivbutton templatecenteredbutton" type="submit"><span class="material-icons-outlined">
                        check
                    </span>Update</button>
                -->

        </div>
    </div>

    <h2 class="templatecontentheaderleft">Danger Zone</h2>

    <div class="infodiv">
        <form method="POST" id="deleteAccountForm">
            <div class="templatedivflex2 menuflex">
                <div class="templatedivflex2left">

                    <button type="button" onclick="confirmDeleteAccount()" class="templatedivbutton templatecenteredbutton redactionbutton"><span class="material-icons-outlined">
                                cancel
                                </span>Delete account</button>

                </div>

                <div class="templatedivflex2left">

                    <button type="button" onclick="confirmLogout()" class="templatedivbutton templatecenteredbutton redactionbutton"><span class="material-icons-outlined">
                            arrow_forward
                            </span>Log Out</button>

                </div>
            </div>
        </form>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="deleteAccountModal" class="confirmation-modal" style="display: none;">
    <div class="modal-content">
        <h2><span class="material-icons-outlined" style="color: #ff4444;">warning</span> Delete Account</h2>
        <p>Are you sure you want to <strong>permanently delete</strong> your account?</p>
        <p style="color: #ff6666;">This action cannot be undone. All your data, including your nation, resources, and progress will be lost forever.</p>
        <div class="modal-input">
            <label>Type your country name to confirm: <strong>{{ user.username }}</strong></label>
            <input type="text" id="deleteConfirmInput" placeholder="Enter country name" />
        </div>
        <div class="modal-buttons">
            <button onclick="closeDeleteModal()" class="templatedivbutton">Cancel</button>
            <button onclick="executeDelete()" class="templatedivbutton redactionbutton" id="confirmDeleteBtn" disabled>Delete Forever</button>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="confirmation-modal" style="display: none;">
    <div class="modal-content">
        <h2><span class="material-icons-outlined">logout</span> Log Out</h2>
        <p>Are you sure you want to log out?</p>
        <div class="modal-buttons">
            <button onclick="closeLogoutModal()" class="templatedivbutton">Cancel</button>
            <a href="/logout" class="templatedivbutton redactionbutton">Yes, Log Out</a>
        </div>
    </div>
</div>

<style>
.confirmation-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.modal-content {
    background: #1a1a2e;
    padding: 30px;
    border-radius: 10px;
    max-width: 450px;
    width: 90%;
    text-align: center;
    border: 1px solid #333;
}

.modal-content h2 {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.modal-content p {
    margin-bottom: 15px;
    color: #ccc;
}

.modal-input {
    margin: 20px 0;
    text-align: left;
}

.modal-input label {
    display: block;
    margin-bottom: 8px;
    color: #aaa;
}

.modal-input input {
    width: 100%;
    padding: 10px;
    border: 1px solid #444;
    border-radius: 5px;
    background: #0f0f1a;
    color: #fff;
    font-size: 14px;
}

.modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
}

.modal-buttons .templatedivbutton {
    min-width: 120px;
}

#confirmDeleteBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
</style>

<script>
const expectedName = "{{ user.username }}";

function confirmDeleteAccount() {
    document.getElementById('deleteAccountModal').style.display = 'flex';
    document.getElementById('deleteConfirmInput').value = '';
    document.getElementById('confirmDeleteBtn').disabled = true;
}

function closeDeleteModal() {
    document.getElementById('deleteAccountModal').style.display = 'none';
}

function confirmLogout() {
    document.getElementById('logoutModal').style.display = 'flex';
}

function closeLogoutModal() {
    document.getElementById('logoutModal').style.display = 'none';
}

document.getElementById('deleteConfirmInput').addEventListener('input', function() {
    const btn = document.getElementById('confirmDeleteBtn');
    btn.disabled = this.value !== expectedName;
});

function executeDelete() {
    if (document.getElementById('deleteConfirmInput').value === expectedName) {
        // Create and submit form to delete account
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/delete_own_account';
        document.body.appendChild(form);
        form.submit();
    }
}

// Close modals when clicking outside
document.getElementById('deleteAccountModal').addEventListener('click', function(e) {
    if (e.target === this) closeDeleteModal();
});

document.getElementById('logoutModal').addEventListener('click', function(e) {
    if (e.target === this) closeLogoutModal();
});

// Close modals with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeDeleteModal();
        closeLogoutModal();
    }
});
</script>
</div>
{% endblock %}
