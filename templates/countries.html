{% extends "layout.html" %} {% block title %} Countries {% endblock %} {% block body %}

<div class="templatediv">

    <div class="templatedivtopper countriestopper">
        <h1 class="templatedivtitle"><span class="material-icons-outlined iconlarge">
            person_pin_circle
            </span>Countries</h1>
    </div>

    <div class="templatedivcontent">
        <form action="/countries" method="GET">
            <div class="templatedivflex2 divflex2full">

                <div class="templatedivflex2left">

                    <select name="sort" class="templateselect">
                        <option value="influence" class="templateoption" {% if sort == 'influence' %}selected{% endif %}>Influence</option>
                        <!-- <option class="templateoption">Military</option> -->
                        <option value="population" class="templateoption" {% if sort == 'population' %}selected{% endif %}>Population</option>
                        <option value="age" class="templateoption" {% if sort == 'age' %}selected{% endif %}>Age</option>
                        <!-- <option class="templateoption">GDP</option> -->
                        <option value="provinces" class="templateoption" {% if sort == 'provinces' %}selected{% endif %}>Provinces</option>
                        <option value="war_range" class="templateoption" {% if sort == 'war_range' %}selected{% endif %}>War Range</option>
                    </select>

                </div>
                <div class="templatedivflex2right">

                    <select name="sortway" class="templateselect">
                        <option value="desc" class="templateoption" {% if sortway == 'desc' %}selected{% endif %}>Descending</option>
                        <option value="asc" class="templateoption" {% if sortway == 'asc' %}selected{% endif %}>Ascending</option>
                    </select>

                </div>

                <div class="templatedivflex2left">

                    <input class="loginsignupinput templateflexfullinput" autocomplete="off" name="search" placeholder="Search by name or ID" value="{{ search or '' }}" />

                </div>
                <div class="templatedivflex2right">

                    <select name="per_page" class="templateselect">
                        <option value="50" class="templateoption" {% if per_page == 50 %}selected{% endif %}>50 per page</option>
                        <option value="100" class="templateoption" {% if per_page == 100 %}selected{% endif %}>100 per page</option>
                        <option value="150" class="templateoption" {% if per_page == 150 %}selected{% endif %}>150 per page</option>
                    </select>

                </div>

                <div class="templatedivflex2left">
                    <button class="center templatedivbutton smallactionbutton" type="submit"><span class="material-icons-outlined">
                        arrow_forward
                        </span>Submit</button>
                </div>

            </div>
        </form>

        <!-- Result count info -->
        {% if total_count is defined %}
        <p style="text-align: center; margin: 10px 0; color: #888;">
            Showing {{ countries|length }} of {{ total_count }} nations
            {% if search %} matching "{{ search }}"{% endif %}
        </p>
        {% endif %}

        <!-- Hidden preserved-link for tests and clients: keeps current query params present in HTML -->
        <a href="{{ url_for('countries', page=1, sort=sort, sortway=sortway, search=search, lowerinf=lowerinf, upperinf=upperinf, province_range=province_range, per_page=per_page) }}" style="display:none;">preserve</a>

        <div class="templateoutertablediv">
            <table class="templatetable templatetable2">
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Influence</th>
                    <th>Date Created</th>
                    <th>Coalition</th>
                    <th>Provinces</th>

                    {% for id, username, date, flag, province_population, colId, colName, province_count, influence, unix in countries %}
                    <tr {% if id == current_user_id %}class="highlight-row"{% endif %}>

                        <!--
                        {% if flag != None %}
                        {% endif %}
                        -->

                        <td>{{ loop.index }})</td>
                        <td><a href="/country/id={{ id }}">{{ username }}</a></td>
                        <td>{{ influence }}</td>
                        <td>{{ date }}</td>
                        {% if colName == None %}
                        <td>No coalition</td>
                        {% else %}
                        <td><a href="/coalition/{{ colId }}">{{ colName }}</a></td>
                        {% endif %}
                        <td>{{ province_count }}</td>


                    </tr>
                    {% endfor %}

            </table>
        </div>

        <!-- Pagination controls -->
        {% if total_pages and total_pages > 1 %}
        <div class="pagination" style="text-align: center; margin-top: 20px; padding: 10px;">
            {% if current_page > 1 %}
                <a href="{{ url_for('countries', page=1, sort=sort, sortway=sortway, search=search, lowerinf=lowerinf, upperinf=upperinf, province_range=province_range, per_page=per_page) }}" class="templatedivbutton smallactionbutton">First</a>
                <a href="{{ url_for('countries', page=current_page - 1, sort=sort, sortway=sortway, search=search, lowerinf=lowerinf, upperinf=upperinf, province_range=province_range, per_page=per_page) }}" class="templatedivbutton smallactionbutton">← Prev</a>
            {% endif %}

            <!-- Page number links -->
            {% set start_page = [current_page - 2, 1] | max %}
            {% set end_page = [current_page + 2, total_pages] | min %}

            {% for p in range(start_page, end_page + 1) %}
                {% if p == current_page %}
                    <span class="templatedivbutton smallactionbutton" style="background: #444;">{{ p }}</span>
                {% else %}
                    <a href="{{ url_for('countries', page=p, sort=sort, sortway=sortway, search=search, lowerinf=lowerinf, upperinf=upperinf, province_range=province_range, per_page=per_page) }}" class="templatedivbutton smallactionbutton">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if current_page < total_pages %}
                <a href="{{ url_for('countries', page=current_page + 1, sort=sort, sortway=sortway, search=search, lowerinf=lowerinf, upperinf=upperinf, province_range=province_range, per_page=per_page) }}" class="templatedivbutton smallactionbutton">Next →</a>
                <a href="{{ url_for('countries', page=total_pages, sort=sort, sortway=sortway, search=search, lowerinf=lowerinf, upperinf=upperinf, province_range=province_range, per_page=per_page) }}" class="templatedivbutton smallactionbutton">Last</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock%}
